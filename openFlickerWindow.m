function [monitor CB EC glow BGColor soundwave] = openFlickerWindow(numOfCB, screenNum)
% CB: textures, positions
% glow: textures, positions




%if numOfCB == 10
    CB1File = './figure/checkerboard192a.bmp';
    CB2File = './figure/checkerboard192b.bmp';
    %CB1File = './figure/white_192.bmp';
    %CB2File = './figure/black_192.bmp';
    %CB1File = './figure/black_192.bmp';
    %CB2File = './figure/white_192.bmp';
    glowFile = './figure/glow192.bmp';
    
%else
    %CB1File = './figure/checkerboard_2cpd_a.bmp';
    %CB2File = './figure/checkerboard_2cpd_b.bmp';
%    CB1File = './figure/white_2cpd.bmp';
%    CB2File = './figure/black_2cpd.bmp';
%    glowFile = './figure/glow.bmp';
    %ECFile = './figure/eyecatcher192.bmp';
%end
ECFile = './figure/eyecatcher.bmp';

%gray
BGColor = [85 85 102];
%white
%BGColor = [255 255 255];
%black
%BGColor = [0 0 0];

monitor = Screen('OpenWindow', screenNum); % flickerMonitor

CB1 = imread(CB1File);
CB2 = imread(CB2File);
CBInfo = imfinfo(CB1File);

CB1 = Screen('MakeTexture', monitor, CB1);
CB2 = Screen('MakeTexture', monitor, CB2);
CB.textures = [CB1 CB2];
CBCorner = floor([-abs([CBInfo.Width CBInfo.Height]) abs([CBInfo.Width CBInfo.Height])]/2);

EC = imread(ECFile);
ECInfo = imfinfo(ECFile);

EC.texture = Screen('MakeTexture', monitor, EC);
ECCorner = floor([-abs([ECInfo.Width ECInfo.Height]) abs([ECInfo.Width ECInfo.Height])]/2);

glow = imread(glowFile);
glowInfo = imfinfo(glowFile);

glow.texture = Screen('MakeTexture', monitor, glow);
glowCorner = floor([-abs([glowInfo.Width glowInfo.Height]) abs([glowInfo.Width glowInfo.Height])]/2);


tone2 = [880 1318.51]; % Hz
tone4 = [783.99 987.77 1174.66 1567.98]; % Hz
tone6 = [587.33 783.99 987.77 1174.66 1567.98 1975.53]; %Hz
tone8 = [493.88 587.33 783.99 987.77 1174.66 1567.98 1975.53 2349.32]; % Hz
tone10 = [392.00 493.88 587.33 783.99 987.77 1174.66 1567.98 1975.53 2349.32 3135.96]; % Hz
soundLength = .125;


HideCursor;
priorityLevel = MaxPriority(monitor);
Priority(priorityLevel);
Screen('FillRect', monitor, BGColor);
Screen('TextColor', monitor, 0);
Screen('Flip', monitor)


switch numOfCB
  case 1
    CB.positions =  repmat([...
      720 600;...
			],1,2)+ CBCorner;
   EC.positions = CB.positions;
   soundwave = sin(sort(tone2(:))*(0:(round(8192*soundLength) - 1))*2*pi/8192);
	case 2
		CB.positions = repmat([...
      720 600;...
			1200 600 ...
			], 1, 2)...
			+ repmat(CBCorner, 2, 1);
    
    EC.positions = repmat(CB.positions(:,1:2) + repmat([120 300],2,1),1,2) + repmat(ECCorner, 2, 1);
      
		
		soundwave = sin(sort(tone2(:))*(0:(round(8192*soundLength) - 1))*2*pi/8192);
	case 4
		CB.positions = repmat([...
            960 300;...
			...
			600 540;...
			1320 540;...
			...
			960 780 ...
			], 1, 2)...
			+ repmat(CBCorner, 4, 1);
		EC.positions = repmat(CB.positions(:,1:2) + repmat([120 300],4,1),1,2) + repmat(ECCorner, 4, 1);
		soundwave = sin(sort(tone4(:))*(0:(round(8192*soundLength) - 1))*2*pi/8192);
	case 6
		CB.positions = repmat([...
			480 300;...
			960 300;...
			1440 300;...
			...
			480 780;...
			960 780;...
			1440 780 ...
			], 1, 2)...
			+ repmat(CBCorner, 6, 1);
    
		EC.positions = repmat(CB.positions(:,1:2) + repmat([120 300],6,1),1,2) + repmat(ECCorner, 6, 1);
		soundwave = sin(sort(tone6(:))*(0:(round(8192*soundLength) - 1))*2*pi/8192);
		
	case 8
		CB.positions = repmat([...
			382 348;...
			766 348;...
			1150 348;...
			1534 348;...
      ...
			382 732;...
			766 732;...
			1150 732;...
			1534 732;...
			], 1, 2)...
			+ repmat(CBCorner, 8, 1);
			
			
			
      EC.positions = repmat([...
			382 504;...
			766 504;...
			1150 504;...
			1534 504;...
			...
			382 888;...
			766 888;...
			1150 888;...
			1534 888;...
			], 1, 2)...
			+ repmat(ECCorner, 8, 1);
    
    soundwave = sin(sort(tone8(:))*(0:(round(8192*soundLength) - 1))*2*pi/8192);
	
	case 10
		CB.positions = repmat([...
			192 348;...
			576 348;...
			960 348;...
			1344 348;...
			1728 348;...
			...
			192 732;...
			576 732;...
			960 732;...
			1344 732;...
			1728 732;...
			], 1, 2)...
			+ repmat(CBCorner, 10, 1);
      
    EC.positions = repmat([...
			192 504;...
			576 504;...
			960 504;...
			1344 504;...
			1728 504;...
			...
			192 888;...
			576 888;...
			960 888;...
			1344 888;...
			1728 888;...
			], 1, 2)...
			+ repmat(ECCorner, 10, 1);
		
		soundwave = sin(sort(tone10(:))*(0:(round(8192*soundLength) - 1))*2*pi/8192);
end

if numOfCB ~=0
  glow.positions = CB.positions + repmat((glowCorner - CBCorner), numOfCB, 1);
end
end
